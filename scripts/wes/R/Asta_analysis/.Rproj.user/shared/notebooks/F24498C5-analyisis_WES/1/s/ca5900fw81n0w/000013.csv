"0","km_df <- final_plotting_df %>%"
"0","  mutate("
"0","    Vital.Status = tolower(trimws(as.character(Vital.Status))),"
"0","    Overall.Survival = as.numeric(Overall.Survival),"
"0","    time_years = Overall.Survival / 365.25,"
"0","    event = ifelse(Vital.Status == ""dead"", 1,"
"0","                   ifelse(Vital.Status == ""alive"", 0, NA))"
"0","  ) %>%"
"0","  filter(!is.na(time_years), !is.na(event), !is.na(nsSNV)) %>%"
"0","  filter(Patient.ID != ""Pt8"")"
"0",""
"0","# tertiles on nsSNV, keep top vs bottom"
"0","q <- quantile(km_df$nsSNV, probs = c(1/3, 2/3), na.rm = TRUE)"
"0","km_df <- km_df %>%"
"0","  mutate(group = case_when("
"0","    nsSNV <= q[1] ~ ""Bottom third"","
"0","    nsSNV >= q[2] ~ ""Top third"","
"0","    TRUE ~ ""Middle third"""
"0","  )) %>%"
"0","  filter(group %in% c(""Top third"", ""Bottom third"")) %>%"
"0","  mutate(group = factor(group, levels = c(""Top third"", ""Bottom third"")))"
"0",""
"0","fit  <- survfit(Surv(time_years, event) ~ group, data = km_df)"
"0","sd   <- survdiff(Surv(time_years, event) ~ group, data = km_df)"
"0","pval <- 1 - pchisq(sd$chisq, df = 1)"
"0",""
"0","# Save (headless-safe)"
"0","ragg::agg_png(""figure_A_rep.png"", width = 6, height = 5, units = ""in"", res = 300)"
"0",""
"0","plot("
"0","  fit,"
"0","  col = c(""red"", ""blue""),"
"0","  lty = c(2, 3),"
"0","  lwd = 2,"
"0","  mark.time = TRUE,"
"0","  mark = 3,"
"0","  xlab = ""Survival (years)"","
"0","  ylab = ""Fraction surviving"","
"0","  xlim = c(0, 6),"
"0","  ylim = c(0, 1)"
"0",")"
